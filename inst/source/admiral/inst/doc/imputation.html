<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Date and Time Imputation</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Date and Time Imputation</h1>



<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>This vignette is broken into three major sections. The first section
briefly explores the imputation rules used in <code>{admiral}</code>.
The second section focuses on imputation functions that work on vectors
with lots of small examples to explore the imputation rules. These
<strong>vector-based</strong> functions form the backbone of
<code>{admiral}</code>’s more powerful functions
<code>derive_vars_dt()</code> and <code>derive_vars_dtm()</code> for
building ADaM dataset. The final section moves into more detailed
examples that a user might face while working on ADaMs in need of
<code>---DT</code> and <code>---DTM</code> variables.</p>
<div id="required-packages" class="section level2">
<h2>Required Packages</h2>
<p>The examples of this vignette require the following packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(admiral)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(dplyr, <span class="at">warn.conflicts =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>
<div id="imputation-rules" class="section level1">
<h1>Imputation Rules</h1>
<p>Date and time is collected in SDTM as character values using the
extended <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a>
format. For example, <code>&quot;2019-10-9T13:42:00&quot;</code>. It allows that
some parts of the date or time are missing, e.g., <code>&quot;2019-10&quot;</code>
if the day and the time is unknown.</p>
<p>The ADaM timing variables like <code>ADTM</code> (Analysis Datetime)
or <code>ADY</code> (Analysis Relative Day) are numeric variables. They
can be derived only if the date or datetime is complete. Therefore
<code>{admiral}</code> provides imputation functions which fill in
missing date or time parts according to certain imputation rules.</p>
<p>In <code>{admiral}</code> users will primarily use two functions
<code>derive_vars_dt()</code> and <code>derive_vars_dtm()</code> for
date and datetime imputations respectively. In all other functions where
dates can be passed as an argument, we expect full dates or datetimes
(unless otherwise specified), so if any possibility of partials then
these functions should be used as a first step to make the required
imputation.</p>
<p>The functions that need to do date/time imputation follow a rule that
we have called <strong>Highest Imputation</strong>, which has a
corresponding argument in all our functions called
<code>highest_imputation</code>. The rule is best explained by working
through the examples below, but to put it briefly, this rule allows a
user to control which components of the DTC value are imputed if they
are missing.</p>
<p>The default imputation for <code>_dtm()</code> functions,
e.g. <code>impute_dtc_dtm()</code>, <code>derive_vars_dtm()</code>, is
“h” (hours). A user can specify that that no imputation is to be done by
setting <code>highest_imputation = n</code>. However, for for
<code>_dt()</code> functions, e.g. <code>impute_dtc_dt()</code>,
<code>derive_vars_dt()</code> the default imputation is already set as
<code>highest_imputation = &quot;n&quot;</code>.</p>
<p>Care must be taken when deciding on level of imputation. If a
component is at a higher level than the highest imputation level is
missing, <code>NA_character_</code> is returned. For example, for
<code>highest_imputation = &quot;D&quot;</code> <code>&quot;2020&quot;</code> results in
<code>NA_character_</code> because the month is missing.</p>
<p>We encourage readers to explore in more detail the
<code>highest_imputation</code> options in both the <code>_dtm()</code>
and <code>_dt()</code> function documentations and in the examples
below.</p>
<div id="imputation-on-a-vector" class="section level2">
<h2>Imputation on a Vector</h2>
<p>In our first example, we will make use of
<code>impute_dtc_dtm()</code> on <code>2019-10</code> setting
<code>highest_imputation = &quot;M&quot;</code>. The argument
<code>date_imputation</code> and <code>time_imputation</code> are given
expressed inputs of the imputation we would like to see done.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="st">&quot;2019-10&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;01-01&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-10-01T00:00:00&quot;</span></span></code></pre></div>
<p>Next we impute using <code>2019-02</code>, which if done naively can
result in invalid dates, e.g.,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="st">&quot;2019-02&quot;</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;02-31&quot;</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-31T00:00:00&quot;</span></span></code></pre></div>
<p>Therefore the keywords <code>&quot;first&quot;</code> or <code>&quot;last&quot;</code>
can be specified in <code>date_imputation</code> to request that missing
parts are replaced by the first or last possible value - giving us a
valid date!</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="st">&quot;2019-02&quot;</span>,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>)</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-28T00:00:00&quot;</span></span></code></pre></div>
<p>For dates, there is the additional option to use keyword
<code>&quot;mid&quot;</code> to impute missing day to <code>15</code> or missing
day and month to <code>06-30</code>, but note the different behavior
below depending on the <code>preserve</code> argument for the case when
month only is missing:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="st">&quot;2019-02&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="st">&quot;2019&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="st">&quot;2019---01&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  dates,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;mid&quot;</span>,</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span>,</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="at">preserve =</span> <span class="cn">FALSE</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>)</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-15T00:00:00&quot; &quot;2019-06-30T00:00:00&quot; &quot;2019-06-30T00:00:00&quot;</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  dates,</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;mid&quot;</span>,</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span>,</span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>  <span class="at">preserve =</span> <span class="cn">TRUE</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-15T00:00:00&quot; &quot;2019-06-30T00:00:00&quot; &quot;2019-06-01T00:00:00&quot;</span></span></code></pre></div>
<p>If you wanted to achieve a similar result by replacing any missing
part of the date with a fixed value <code>06-15</code>, this is also
possible, but note the difference in days for cases when month is
missing:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="st">&quot;2019-02&quot;</span>,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="st">&quot;2019&quot;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="st">&quot;2019---01&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>)</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  dates,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;06-15&quot;</span>,</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;00:00:00&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-15T00:00:00&quot; &quot;2019-06-15T00:00:00&quot; &quot;2019-06-15T00:00:00&quot;</span></span></code></pre></div>
</div>
<div id="imputation-level" class="section level2">
<h2>Imputation Level</h2>
<p>The imputation level, i.e., which components are imputed if they are
missing, is controlled by the <code>highest_imputation</code> argument.
All components up to the specified level are imputed.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="st">&quot;2019-02-03T12:30:15&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  <span class="st">&quot;2019-02-03T12:30&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="st">&quot;2019-02-03&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>  <span class="st">&quot;2019-02&quot;</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>  <span class="st">&quot;2019&quot;</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co"># Do not impute</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>  dates,</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;n&quot;</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-03T12:30:15&quot; NA                    NA                   </span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; [4] NA                    NA</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a><span class="co"># Impute seconds only</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>  dates,</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;s&quot;</span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>)</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-03T12:30:15&quot; &quot;2019-02-03T12:30:00&quot; NA                   </span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt; [4] NA                    NA</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co"># Impute time (hours, minutes, seconds) only</span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>  dates,</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;h&quot;</span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>)</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-03T12:30:15&quot; &quot;2019-02-03T12:30:00&quot; &quot;2019-02-03T00:00:00&quot;</span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co">#&gt; [4] NA                    NA</span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="co"># Impute days and time</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>  dates,</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;D&quot;</span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>)</span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-03T12:30:15&quot; &quot;2019-02-03T12:30:00&quot; &quot;2019-02-03T00:00:00&quot;</span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt; [4] &quot;2019-02-01T00:00:00&quot; NA</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co"># Impute date (months and days) and time</span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>  dates,</span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a>)</span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-03T12:30:15&quot; &quot;2019-02-03T12:30:00&quot; &quot;2019-02-03T00:00:00&quot;</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt; [4] &quot;2019-02-01T00:00:00&quot; &quot;2019-01-01T00:00:00&quot;</span></span></code></pre></div>
<p>For imputation of years (<code>highest_imputation = &quot;Y&quot;</code>) see
next section.</p>
</div>
<div id="minimummaximum-dates" class="section level2">
<h2>Minimum/Maximum Dates</h2>
<p>In some scenarios the imputed date should not be before or after
certain dates. For example an imputed date after data cut off date or
death date is not desirable. The <code>{admiral}</code> imputation
functions provide the <code>min_dates</code> and <code>max_dates</code>
argument to specify those dates. For example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="st">&quot;2019-02&quot;</span>,</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="at">max_dates =</span> <span class="fu">list</span>(<span class="fu">ymd</span>(<span class="st">&quot;2019-01-14&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;2019-02-25&quot;</span>))</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-25T23:59:59&quot;</span></span></code></pre></div>
<p>It is ensured that the imputed date is not after any of the specified
dates. Only dates which are in the range of possible dates of the DTC
value are considered. The possible dates are defined by the missing
parts of the DTC date, i.e., for “2019-02” the possible dates range from
“2019-02-01” to “2019-02-28”. Thus “2019-01-14” is ignored. This ensures
that the non-missing parts of the DTC date are not changed.</p>
<p>If the <code>min_dates</code> or <code>max_dates</code> argument is
specified, it is also possible to impute completely missing dates. For
<code>date_imputation = &quot;first&quot;</code> the <code>min_dates</code>
argument must be specified and for <code>date_imputation = &quot;last&quot;</code>
the <code>max_dates</code> argument. For other imputation rules imputing
the year is not possible.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Impute year to first</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;2019-02&quot;</span>, <span class="cn">NA</span>),</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="at">min_dates =</span> <span class="fu">list</span>(</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>    <span class="fu">ymd</span>(<span class="st">&quot;2019-01-14&quot;</span>, <span class="cn">NA</span>),</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>    <span class="fu">ymd</span>(<span class="st">&quot;2019-02-25&quot;</span>, <span class="st">&quot;2020-01-01&quot;</span>)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  )</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-25T00:00:00&quot; &quot;2020-01-01T00:00:00&quot;</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co"># Impute year to last</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="fu">impute_dtc_dtm</span>(</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">&quot;2019-02&quot;</span>, <span class="cn">NA</span>),</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>  <span class="at">highest_imputation =</span> <span class="st">&quot;Y&quot;</span>,</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>  <span class="at">date_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>  <span class="at">time_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>  <span class="at">max_dates =</span> <span class="fu">list</span>(</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>    <span class="fu">ymd</span>(<span class="st">&quot;2019-01-14&quot;</span>, <span class="cn">NA</span>),</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>    <span class="fu">ymd</span>(<span class="st">&quot;2019-02-25&quot;</span>, <span class="st">&quot;2020-01-01&quot;</span>)</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>  )</span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>)</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-02-25T23:59:59&quot; &quot;2020-01-01T23:59:59&quot;</span></span></code></pre></div>
</div>
</div>
<div id="imputation-flags" class="section level1">
<h1>Imputation Flags</h1>
<p>ADaM requires that date or datetime variables for which imputation
was used are accompanied by date and/or time imputation flag variables
(<code>*DTF</code> and <code>*TMF</code>, e.g., <code>ADTF</code> and
<code>ATMF</code> for <code>ADTM</code>). These variables indicate the
highest level that was imputed, e.g., if minutes and seconds were
imputed, the imputation flag is set to <code>&quot;M&quot;</code>. The
<code>{admiral}</code> functions which derive imputed variables are also
adding the corresponding imputation flag variables.</p>
<p>Note: The <code>{admiral}</code> datetime imputation function
provides the <code>ignore_seconds_flag</code> argument which can be set
to <code>TRUE</code> in cases where seconds were never collected. This
is due to the following from ADaM IG: For a given SDTM DTC variable, if
only hours and minutes are ever collected, and seconds are imputed in
<code>*DTM</code> as <code>00</code>, then it is not necessary to set
<code>*TMF</code> to <code>&quot;S&quot;</code>.</p>
</div>
<div id="imputation-functions" class="section level1">
<h1>Imputation Functions</h1>
<p><code>{admiral}</code> provides the following functions for
imputation:</p>
<ul>
<li><code>derive_vars_dt()</code>: Adds a date variable and a date
imputation flag variable (optional) based on a –DTC variable and
imputation rules.</li>
<li><code>derive_vars_dtm()</code>: Adds a datetime variable, a date
imputation flag variable, and a time imputation flag variable (both
optional) based on a –DTC variable and imputation rules.</li>
<li><code>impute_dtc_dtm()</code>: Returns a complete ISO 8601 datetime
or <code>NA</code> based on a partial ISO 8601 datetime and imputation
rules.</li>
<li><code>impute_dtc_dt()</code>: Returns a complete ISO 8601 date
(without time) or <code>NA</code> based on a partial ISO 8601 date(time)
and imputation rules.</li>
<li><code>convert_dtc_to_dt()</code>: Returns a date if the input ISO
8601 date is complete. Otherwise, <code>NA</code> is returned.</li>
<li><code>convert_dtc_to_dtm()</code>: Returns a datetime if the input
ISO 8601 date is complete (with missing time replaced by
<code>&quot;00:00:00&quot;</code> as default). Otherwise, NA is returned.</li>
<li><code>compute_dtf()</code>: Returns the date imputation flag.</li>
<li><code>compute_tmf()</code>: Returns the time imputation flag.</li>
</ul>
</div>
<div id="examples" class="section level1">
<h1>Examples</h1>
<div id="create-an-imputed-datetime-and-date-variable-and-imputation-flag-variables" class="section level2">
<h2>Create an Imputed Datetime and Date Variable and Imputation Flag
Variables</h2>
<p>The <code>derive_vars_dtm()</code> function derives an imputed
datetime variable and the corresponding date and time imputation flags.
The imputed date variable can be derived by using the
<code>derive_vars_dtm_to_dt()</code> function. It is not necessary and
advisable to perform the imputation for the date variable if it was
already done for the datetime variable. CDISC considers the datetime and
the date variable as two representations of the same date. Thus the
imputation must be the same and the imputation flags are valid for both
the datetime and the date variable.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>ae <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="sc">~</span>AESTDTC,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  <span class="st">&quot;2019-08-09T12:34:56&quot;</span>,</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="st">&quot;2019-04-12&quot;</span>,</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="st">&quot;2010-09&quot;</span>,</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="cn">NA_character_</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    <span class="at">dtc =</span> AESTDTC,</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;AST&quot;</span>,</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    <span class="at">date_imputation =</span> <span class="st">&quot;first&quot;</span>,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    <span class="at">time_imputation =</span> <span class="st">&quot;first&quot;</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>  <span class="fu">derive_vars_dtm_to_dt</span>(<span class="fu">exprs</span>(ASTDTM))</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">AESTDTC</th>
<th align="left">ASTDTM</th>
<th align="left">ASTDTF</th>
<th align="left">ASTTMF</th>
<th align="left">ASTDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-08-09T12:34:56</td>
<td align="left">2019-08-09 12:34:56</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">2019-08-09</td>
</tr>
<tr class="even">
<td align="left">2019-04-12</td>
<td align="left">2019-04-12 00:00:00</td>
<td align="left">NA</td>
<td align="left">H</td>
<td align="left">2019-04-12</td>
</tr>
<tr class="odd">
<td align="left">2010-09</td>
<td align="left">2010-09-01 00:00:00</td>
<td align="left">D</td>
<td align="left">H</td>
<td align="left">2010-09-01</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="create-an-imputed-date-variable-and-imputation-flag-variable" class="section level2">
<h2>Create an Imputed Date Variable and Imputation Flag Variable</h2>
<p>If an imputed date variable without a corresponding datetime variable
is required, it can be derived by the <code>derive_vars_dt()</code>
function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>ae <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  <span class="sc">~</span>AESTDTC,</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="st">&quot;2019-08-09T12:34:56&quot;</span>,</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="st">&quot;2019-04-12&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="st">&quot;2010-09&quot;</span>,</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="cn">NA_character_</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  <span class="fu">derive_vars_dt</span>(</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>    <span class="at">dtc =</span> AESTDTC,</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;AST&quot;</span>,</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>    <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    <span class="at">date_imputation =</span> <span class="st">&quot;first&quot;</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">AESTDTC</th>
<th align="left">ASTDT</th>
<th align="left">ASTDTF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-08-09T12:34:56</td>
<td align="left">2019-08-09</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2019-04-12</td>
<td align="left">2019-04-12</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">2010-09</td>
<td align="left">2010-09-01</td>
<td align="left">D</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="impute-time-without-imputing-date" class="section level2">
<h2>Impute Time without Imputing Date</h2>
<p>If the time should be imputed but not the date, the
<code>highest_imputation</code> argument should be set to
<code>&quot;h&quot;</code>. This results in <code>NA</code> if the date is
partial. As no date is imputed the date imputation flag is not
created.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>ae <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="sc">~</span>AESTDTC,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="st">&quot;2019-08-09T12:34:56&quot;</span>,</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="st">&quot;2019-04-12&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="st">&quot;2010-09&quot;</span>,</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>  <span class="cn">NA_character_</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    <span class="at">dtc =</span> AESTDTC,</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;AST&quot;</span>,</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    <span class="at">highest_imputation =</span> <span class="st">&quot;h&quot;</span>,</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    <span class="at">time_imputation =</span> <span class="st">&quot;first&quot;</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">AESTDTC</th>
<th align="left">ASTDTM</th>
<th align="left">ASTTMF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-08-09T12:34:56</td>
<td align="left">2019-08-09 12:34:56</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2019-04-12</td>
<td align="left">2019-04-12 00:00:00</td>
<td align="left">H</td>
</tr>
<tr class="odd">
<td align="left">2010-09</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="avoid-imputed-dates-before-a-particular-date" class="section level2">
<h2>Avoid Imputed Dates Before a Particular Date</h2>
<p>Usually the adverse event start date is imputed as the earliest date
of all possible dates when filling the missing parts. The result may be
a date before treatment start date. This is not desirable because the
adverse event would not be considered as treatment emergent and excluded
from the adverse event summaries. This can be avoided by specifying the
treatment start date variable (<code>TRTSDTM</code>) for the
<code>min_dates</code> argument.</p>
<p>Please note that <code>TRTSDTM</code> is used as imputed date only if
the non missing date and time parts of <code>AESTDTC</code> coincide
with those of <code>TRTSDTM</code>. Therefore <code>2019-10</code> is
not imputed as <code>2019-11-11 12:34:56</code>. This ensures that
collected information is not changed by the imputation.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>ae <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="sc">~</span>AESTDTC,              <span class="sc">~</span>TRTSDTM,</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="st">&quot;2019-08-09T12:34:56&quot;</span>, <span class="fu">ymd_hms</span>(<span class="st">&quot;2019-11-11T12:34:56&quot;</span>),</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="st">&quot;2019-10&quot;</span>,             <span class="fu">ymd_hms</span>(<span class="st">&quot;2019-11-11T12:34:56&quot;</span>),</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="st">&quot;2019-11&quot;</span>,             <span class="fu">ymd_hms</span>(<span class="st">&quot;2019-11-11T12:34:56&quot;</span>),</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  <span class="st">&quot;2019-12-04&quot;</span>,          <span class="fu">ymd_hms</span>(<span class="st">&quot;2019-11-11T12:34:56&quot;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    <span class="at">dtc =</span> AESTDTC,</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;AST&quot;</span>,</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="at">date_imputation =</span> <span class="st">&quot;first&quot;</span>,</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="at">time_imputation =</span> <span class="st">&quot;first&quot;</span>,</span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="at">min_dates =</span> <span class="fu">exprs</span>(TRTSDTM)</span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<colgroup>
<col width="27%" />
<col width="27%" />
<col width="27%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">AESTDTC</th>
<th align="left">TRTSDTM</th>
<th align="left">ASTDTM</th>
<th align="left">ASTDTF</th>
<th align="left">ASTTMF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-08-09T12:34:56</td>
<td align="left">2019-11-11 12:34:56</td>
<td align="left">2019-08-09 12:34:56</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2019-10</td>
<td align="left">2019-11-11 12:34:56</td>
<td align="left">2019-10-01 00:00:00</td>
<td align="left">D</td>
<td align="left">H</td>
</tr>
<tr class="odd">
<td align="left">2019-11</td>
<td align="left">2019-11-11 12:34:56</td>
<td align="left">2019-11-11 12:34:56</td>
<td align="left">D</td>
<td align="left">H</td>
</tr>
<tr class="even">
<td align="left">2019-12-04</td>
<td align="left">2019-11-11 12:34:56</td>
<td align="left">2019-12-04 00:00:00</td>
<td align="left">NA</td>
<td align="left">H</td>
</tr>
</tbody>
</table>
</div>
<div id="avoid-imputed-dates-after-a-particular-date" class="section level2">
<h2>Avoid Imputed Dates After a Particular Date</h2>
<p>If a date is imputed as the latest date of all possible dates when
filling the missing parts, it should not result in dates after data cut
off or death. This can be achieved by specifying the dates for the
<code>max_dates</code> argument.</p>
<p>Please note that non missing date parts are not changed. Thus
<code>2019-12-04</code> is imputed as <code>2019-12-04 23:59:59</code>
although it is after the data cut off date. It may make sense to replace
it by the data cut off date but this is not part of the imputation. It
should be done in a separate data cleaning or data cut off step.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>ae <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="sc">~</span>AEENDTC,              <span class="sc">~</span>DTHDT,            <span class="sc">~</span>DCUTDT,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="st">&quot;2019-08-09T12:34:56&quot;</span>, <span class="fu">ymd</span>(<span class="st">&quot;2019-11-11&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;2019-12-02&quot;</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="st">&quot;2019-11&quot;</span>,             <span class="fu">ymd</span>(<span class="st">&quot;2019-11-11&quot;</span>), <span class="fu">ymd</span>(<span class="st">&quot;2019-12-02&quot;</span>),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="st">&quot;2019-12&quot;</span>,             <span class="cn">NA</span>,                <span class="fu">ymd</span>(<span class="st">&quot;2019-12-02&quot;</span>),</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="st">&quot;2019-12-04&quot;</span>,          <span class="cn">NA</span>,                <span class="fu">ymd</span>(<span class="st">&quot;2019-12-02&quot;</span>)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  <span class="fu">derive_vars_dtm</span>(</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>    <span class="at">dtc =</span> AEENDTC,</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>    <span class="at">new_vars_prefix =</span> <span class="st">&quot;AEN&quot;</span>,</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>    <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>    <span class="at">date_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>    <span class="at">time_imputation =</span> <span class="st">&quot;last&quot;</span>,</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>    <span class="at">max_dates =</span> <span class="fu">exprs</span>(DTHDT, DCUTDT)</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  )</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="26%" />
<col width="14%" />
<col width="14%" />
<col width="26%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">AEENDTC</th>
<th align="left">DTHDT</th>
<th align="left">DCUTDT</th>
<th align="left">AENDTM</th>
<th align="left">AENDTF</th>
<th align="left">AENTMF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-08-09T12:34:56</td>
<td align="left">2019-11-11</td>
<td align="left">2019-12-02</td>
<td align="left">2019-08-09 12:34:56</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">2019-11</td>
<td align="left">2019-11-11</td>
<td align="left">2019-12-02</td>
<td align="left">2019-11-11 23:59:59</td>
<td align="left">D</td>
<td align="left">H</td>
</tr>
<tr class="odd">
<td align="left">2019-12</td>
<td align="left">NA</td>
<td align="left">2019-12-02</td>
<td align="left">2019-12-02 23:59:59</td>
<td align="left">D</td>
<td align="left">H</td>
</tr>
<tr class="even">
<td align="left">2019-12-04</td>
<td align="left">NA</td>
<td align="left">2019-12-02</td>
<td align="left">2019-12-04 23:59:59</td>
<td align="left">NA</td>
<td align="left">H</td>
</tr>
</tbody>
</table>
</div>
<div id="imputation-without-creating-a-new-variable" class="section level2">
<h2>Imputation Without Creating a New Variable</h2>
<p>If imputation is required without creating a new variable the
<code>convert_dtc_to_dt()</code> function can be called to obtain a
vector of imputed dates. It can be used for example in conditions:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>mh <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="sc">~</span>MHSTDTC,     <span class="sc">~</span>TRTSDT,</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="st">&quot;2019-04&quot;</span>,    <span class="fu">ymd</span>(<span class="st">&quot;2019-04-15&quot;</span>),</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="st">&quot;2019-04-01&quot;</span>, <span class="fu">ymd</span>(<span class="st">&quot;2019-04-15&quot;</span>),</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="st">&quot;2019-05&quot;</span>,    <span class="fu">ymd</span>(<span class="st">&quot;2019-04-15&quot;</span>),</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="st">&quot;2019-06-21&quot;</span>, <span class="fu">ymd</span>(<span class="st">&quot;2019-04-15&quot;</span>)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>    <span class="fu">convert_dtc_to_dt</span>(</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>      MHSTDTC,</span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>      <span class="at">highest_imputation =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>      <span class="at">date_imputation =</span> <span class="st">&quot;first&quot;</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>    ) <span class="sc">&lt;</span> TRTSDT</span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">MHSTDTC</th>
<th align="left">TRTSDT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-04</td>
<td align="left">2019-04-15</td>
</tr>
<tr class="even">
<td align="left">2019-04-01</td>
<td align="left">2019-04-15</td>
</tr>
</tbody>
</table>
</div>
<div id="using-more-than-one-imputation-rule-for-a-variable" class="section level2">
<h2>Using More Than One Imputation Rule for a Variable</h2>
<p>Using different imputation rules depending on the observation can be
done by using <code>slice_derivation()</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>vs <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="sc">~</span>VSDTC,                <span class="sc">~</span>VSTPT,</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="st">&quot;2019-08-09T12:34:56&quot;</span>, <span class="cn">NA</span>,</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="st">&quot;2019-10-12&quot;</span>,          <span class="st">&quot;PRE-DOSE&quot;</span>,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="st">&quot;2019-11-10&quot;</span>,          <span class="cn">NA</span>,</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="st">&quot;2019-12-04&quot;</span>,          <span class="cn">NA</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  <span class="fu">slice_derivation</span>(</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>    <span class="at">derivation =</span> derive_vars_dtm,</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>    <span class="at">args =</span> <span class="fu">params</span>(</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>      <span class="at">dtc =</span> VSDTC,</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>      <span class="at">new_vars_prefix =</span> <span class="st">&quot;A&quot;</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>    ),</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>    <span class="fu">derivation_slice</span>(</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a>      <span class="at">filter =</span> VSTPT <span class="sc">==</span> <span class="st">&quot;PRE-DOSE&quot;</span>,</span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>      <span class="at">args =</span> <span class="fu">params</span>(<span class="at">time_imputation =</span> <span class="st">&quot;first&quot;</span>)</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>    ),</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>    <span class="fu">derivation_slice</span>(</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>      <span class="at">filter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>      <span class="at">args =</span> <span class="fu">params</span>(<span class="at">time_imputation =</span> <span class="st">&quot;last&quot;</span>)</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>    )</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">VSDTC</th>
<th align="left">VSTPT</th>
<th align="left">ADTM</th>
<th align="left">ATMF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2019-10-12</td>
<td align="left">PRE-DOSE</td>
<td align="left">2019-10-12 00:00:00</td>
<td align="left">H</td>
</tr>
<tr class="even">
<td align="left">2019-08-09T12:34:56</td>
<td align="left">NA</td>
<td align="left">2019-08-09 12:34:56</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">2019-11-10</td>
<td align="left">NA</td>
<td align="left">2019-11-10 23:59:59</td>
<td align="left">H</td>
</tr>
<tr class="even">
<td align="left">2019-12-04</td>
<td align="left">NA</td>
<td align="left">2019-12-04 23:59:59</td>
<td align="left">H</td>
</tr>
</tbody>
</table>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
