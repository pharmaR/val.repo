<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Holidays and calendars</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Holidays and calendars</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(almanac)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># A rule for weekends</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>on_weekends <span class="ot">&lt;-</span> <span class="fu">weekly</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="fu">recur_on_weekends</span>()</span></code></pre></div>
<p>almanac provides low-level tools for building all manner of
recurrence rules, but it also provides a fairly high-level set of tools
for working with holidays and calendars. These are arguably the most
useful part of almanac, because they do a lot of the heavy lifting of
defining your own holidays and observance rules for you.</p>
<div id="holidays" class="section level2">
<h2>Holidays</h2>
<p>There are a number of pre-generated holidays in almanac, which all
start with <code>hol_*()</code>, such as <code>hol_christmas()</code>.
If the holiday is specific to a country, then it is also prefixed as
such, like <code>hol_us_veterans_day()</code> (currently only global and
US holidays are provided).</p>
<p>A holiday object is just another type of recurrence schedule:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>on_christmas <span class="ot">&lt;-</span> <span class="fu">hol_christmas</span>()</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>on_christmas</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; &lt;Christmas&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;  &lt;rrule&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;  • frequency: yearly</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt;  • range: [1900-01-01, 2100-01-01]</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;  • month of year: Dec</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;  • day of month: 25</span></span></code></pre></div>
<p>This means that you can use it with any of the <code>alma_*()</code>
functions you might have learned about in the other vignettes.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">alma_events</span>(on_christmas, <span class="at">year =</span> <span class="dv">2020</span><span class="sc">:</span><span class="dv">2025</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2020-12-25&quot; &quot;2021-12-25&quot; &quot;2022-12-25&quot; &quot;2023-12-25&quot; &quot;2024-12-25&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; [6] &quot;2025-12-25&quot;</span></span></code></pre></div>
<p>You’ll use these holiday objects to build up a <em>calendar</em>,
which is a bundle of individual holidays that represent the rules of
your specific business.</p>
<p>There are 3 helpers that are specific to holidays:</p>
<ul>
<li><p><code>hol_observe()</code></p></li>
<li><p><code>hol_offset()</code></p></li>
<li><p><code>hol_rename()</code></p></li>
</ul>
<div id="hol_observe" class="section level3">
<h3><code>hol_observe()</code></h3>
<p><code>hol_observe()</code> adjusts a holiday to respect observance
rules that might be set by your company. For example, if Christmas falls
on Saturday, then your company may actually <em>observe</em> it on the
preceding Friday or following Monday.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>on_christmas <span class="ot">&lt;-</span> <span class="fu">hol_christmas</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">hol_observe</span>(<span class="at">adjust_on =</span> on_weekends, <span class="at">adjustment =</span> adj_nearest)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>on_christmas</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; &lt;Christmas&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt;  &lt;radjusted&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt;   adjust:</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt;   &lt;rrule&gt;</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt;   • frequency: yearly</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;   • range: [1900-01-01, 2100-01-01]</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt;   • month of year: Dec</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt;   • day of month: 25</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt;   adjust on:</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt;   &lt;rrule&gt;</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt;   • frequency: weekly</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt;   • range: [1900-01-01, 2100-01-01]</span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt;   • day of week: Sat, and Sun</span></span></code></pre></div>
<p>If you’ve read <code>vignette(&quot;adjust-and-shift&quot;)</code>, then you’ll
recognize that observances look similar to <code>radjusted()</code>, and
in fact that is the tooling that is used under the hood.</p>
<p>If we run our updated holiday through <code>alma_events()</code>
again, you’ll see that it now rolls to the nearest weekday if Christmas
falls on a weekend.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">alma_events</span>(on_christmas, <span class="at">year =</span> <span class="dv">2020</span><span class="sc">:</span><span class="dv">2025</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2020-12-25&quot; &quot;2021-12-24&quot; &quot;2022-12-26&quot; &quot;2023-12-25&quot; &quot;2024-12-25&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; [6] &quot;2025-12-25&quot;</span></span></code></pre></div>
</div>
<div id="hol_offset" class="section level3">
<h3><code>hol_offset()</code></h3>
<p><code>hol_offset()</code> allows you to create holidays that are
<em>relative</em> to some other holiday. For example, Good Friday is
always the Friday before Easter.</p>
<p>Let’s take a look at building a holiday for Boxing Day, the day after
Christmas. <code>hol_offset()</code> retains the name of the original
holiday, so we’ll also need <code>hol_rename()</code> to rename it to
Boxing Day:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>on_boxing_day <span class="ot">&lt;-</span> <span class="fu">hol_christmas</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">hol_offset</span>(<span class="at">by =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">hol_rename</span>(<span class="st">&quot;Boxing Day&quot;</span>)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>on_boxing_day</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; &lt;Boxing Day&gt;</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt;  &lt;roffset[by = 1]&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt;   &lt;rrule&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;   • frequency: yearly</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;   • range: [1900-01-01, 2100-01-01]</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt;   • month of year: Dec</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt;   • day of month: 25</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">alma_events</span>(on_boxing_day, <span class="at">year =</span> <span class="dv">2020</span><span class="sc">:</span><span class="dv">2025</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2020-12-26&quot; &quot;2021-12-26&quot; &quot;2022-12-26&quot; &quot;2023-12-26&quot; &quot;2024-12-26&quot;</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; [6] &quot;2025-12-26&quot;</span></span></code></pre></div>
<p>Great! Now what if we wanted to add an observance rule to Boxing Day?
This is actually pretty complicated, because it is dependent on the
observance rules for Christmas. For example, if Christmas falls on a
Saturday, but is observed on Friday, then we probably want Boxing Day to
be observed on the following Monday. If Christmas falls on a Sunday and
is observed on the following Monday, then Boxing Day would be observed
on the following Tuesday. Luckily you can layer
<code>hol_observe()</code> with <code>hol_offset()</code> to build up a
recurrence schedule that matches the rules we are looking for:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>on_christmas <span class="ot">&lt;-</span> <span class="fu">hol_christmas</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">hol_observe</span>(<span class="at">adjust_on =</span> on_weekends, <span class="at">adjustment =</span> adj_nearest)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>on_boxing_day <span class="ot">&lt;-</span> <span class="fu">hol_christmas</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>  <span class="fu">hol_observe</span>(<span class="at">adjust_on =</span> on_weekends, <span class="at">adjustment =</span> adj_nearest) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="fu">hol_offset</span>(<span class="at">by =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="fu">hol_observe</span>(<span class="at">adjust_on =</span> on_weekends, <span class="at">adjustment =</span> adj_following) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="fu">hol_rename</span>(<span class="st">&quot;Boxing Day&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="at">christmas =</span> <span class="fu">alma_events</span>(on_christmas, <span class="at">year =</span> <span class="dv">2020</span><span class="sc">:</span><span class="dv">2025</span>),</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="at">boxing_day =</span> <span class="fu">alma_events</span>(on_boxing_day, <span class="at">year =</span> <span class="dv">2020</span><span class="sc">:</span><span class="dv">2025</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>df<span class="sc">$</span>christmas_weekday <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(df<span class="sc">$</span>christmas, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>df<span class="sc">$</span>boxing_day_weekday <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">wday</span>(df<span class="sc">$</span>boxing_day, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>df</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt;    christmas boxing_day christmas_weekday boxing_day_weekday</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; 1 2020-12-25 2020-12-28               Fri                Mon</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; 2 2021-12-24 2021-12-27               Fri                Mon</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; 3 2022-12-26 2022-12-27               Mon                Tue</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; 4 2023-12-25 2023-12-26               Mon                Tue</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; 5 2024-12-25 2024-12-26               Wed                Thu</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; 6 2025-12-25 2025-12-26               Thu                Fri</span></span></code></pre></div>
</div>
<div id="custom-holidays" class="section level3">
<h3>Custom holidays</h3>
<p>almanac doesn’t attempt to provide a comprehensive set of holidays.
Instead, it makes it easy for you to create your own using
<code>rholiday()</code>. All you need is a recurrence rule that aligns
with the holiday date and a name. Let’s create one for Canada Day, which
occurs on July 1st each year.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>hol_canada_day <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">since =</span> <span class="cn">NULL</span>, <span class="at">until =</span> <span class="cn">NULL</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">yearly</span>(<span class="at">since =</span> since, <span class="at">until =</span> until)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">recur_on_month_of_year</span>(out, <span class="st">&quot;July&quot;</span>)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">recur_on_day_of_month</span>(out, 1L)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  </span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="fu">rholiday</span>(<span class="at">rschedule =</span> out, <span class="at">name =</span> <span class="st">&quot;Canada Day&quot;</span>)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">hol_canada_day</span>()</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; &lt;Canada Day&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;  &lt;rrule&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt;  • frequency: yearly</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt;  • range: [1900-01-01, 2100-01-01]</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;  • month of year: Jul</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;  • day of month: 1</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="fu">alma_next</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2019-01-01&quot;</span>), <span class="fu">hol_canada_day</span>())</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2019-07-01&quot;</span></span></code></pre></div>
</div>
</div>
<div id="calendars" class="section level2">
<h2>Calendars</h2>
<p>Holidays are great for one off operations, but typically if you are
building a business calendar then you’ll need to bundle multiple
holidays together. To do that, you’ll need a <em>calendar</em> object.
You can create one by providing holidays to
<code>rcalendar()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>cal <span class="ot">&lt;-</span> <span class="fu">rcalendar</span>(</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="fu">hol_christmas</span>(),</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="fu">hol_new_years_day</span>(),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>  <span class="fu">hol_canada_day</span>()</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>cal</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt; &lt;rcalendar[3]&gt;</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; • Christmas</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt; • New Year&#39;s Day</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; • Canada Day</span></span></code></pre></div>
<p>Like holidays, calendars are recurrence schedules that work with any
of the <code>alma_*()</code> functions, but they also have their own
special <code>cal_*()</code> API.</p>
<div id="cal_events" class="section level3">
<h3><code>cal_events()</code></h3>
<p>If you’d like to generate the holidays for a particular year, then
you should use <code>cal_events():</code></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">cal_events</span>(cal, <span class="at">year =</span> <span class="dv">2023</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt;             name       date</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; 1 New Year&#39;s Day 2023-01-01</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; 2     Canada Day 2023-07-01</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; 3      Christmas 2023-12-25</span></span></code></pre></div>
<p>This is similar to <code>alma_events()</code>, but there are two big
differences:</p>
<ul>
<li><p>The holiday name is displayed along with the event date</p></li>
<li><p>It has special support for observance rules</p></li>
</ul>
<p>Note that we didn’t add any observance rules into our original
calendar, let’s go back and adjust our holidays to roll off
weekends:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>cal <span class="ot">&lt;-</span> <span class="fu">rcalendar</span>(</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">hol_christmas</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>    <span class="fu">hol_observe</span>(<span class="at">adjust_on =</span> on_weekends, <span class="at">adjustment =</span> adj_nearest),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>  <span class="fu">hol_new_years_day</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>    <span class="fu">hol_observe</span>(<span class="at">adjust_on =</span> on_weekends, <span class="at">adjustment =</span> adj_nearest),</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>  <span class="co"># Canada normally rolls their holidays forward to the following Monday</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>  <span class="fu">hol_canada_day</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    <span class="fu">hol_observe</span>(<span class="at">adjust_on =</span> on_weekends, <span class="at">adjustment =</span> adj_following)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>)</span></code></pre></div>
<p>Note that the holidays generated by <code>cal_events()</code> are
different from the previous ones because they now respect the observance
rules when a holiday falls on a weekend.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">cal_events</span>(cal, <span class="at">year =</span> <span class="dv">2023</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co">#&gt;             name       date</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co">#&gt; 1 New Year&#39;s Day 2023-01-02</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; 2     Canada Day 2023-07-03</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; 3      Christmas 2023-12-25</span></span></code></pre></div>
<p>There is one more observance related feature worth pointing out.
Let’s take a look at holidays for 2011:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">cal_events</span>(cal, <span class="at">year =</span> <span class="dv">2011</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt;             name       date</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="co">#&gt; 1 New Year&#39;s Day 2010-12-31</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="co">#&gt; 2     Canada Day 2011-07-01</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="co">#&gt; 3      Christmas 2011-12-26</span></span></code></pre></div>
<p>New Year’s Day fell on a Saturday that year, so it was adjusted
<em>backwards</em> to the preceding Friday, which actually fell in 2010.
<code>cal_events()</code> is smart enough to know that if you are
requesting “2011’s holidays,” then New Year’s Day should probably be
included even if it was <em>observed</em> in a different year.</p>
<p>If you don’t want this behavior, you can set
<code>observed = TRUE</code> to use the observed year when filtering for
the <code>year</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># New Year&#39;s Day is gone</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">cal_events</span>(cal, <span class="at">year =</span> <span class="dv">2011</span>, <span class="at">observed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co">#&gt;         name       date</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="co">#&gt; 1 Canada Day 2011-07-01</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; 2  Christmas 2011-12-26</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="co"># And is now listed twice here</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="fu">cal_events</span>(cal, <span class="at">year =</span> <span class="dv">2010</span>, <span class="at">observed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="co">#&gt;             name       date</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; 1 New Year&#39;s Day 2010-01-01</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="co">#&gt; 2     Canada Day 2010-07-01</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="co">#&gt; 3      Christmas 2010-12-24</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; 4 New Year&#39;s Day 2010-12-31</span></span></code></pre></div>
</div>
<div id="cal_match" class="section level3">
<h3><code>cal_match()</code></h3>
<p>If you’ve ever needed to determine if a date is a holiday, then
you’ve likely reached for <code>alma_in()</code>, which works like
<code>%in%</code> and returns a logical vector. But if you also need to
determine <em>which</em> holiday that date corresponded to, then you’ll
need to use <code>cal_match()</code> instead:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="st">&quot;2019-12-25&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="st">&quot;2019-12-26&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="st">&quot;2010-12-31&quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="st">&quot;2011-01-01&quot;</span></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>))</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="at">x =</span> x,</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">cal_match</span>(x, cal)</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>)</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt;            x           name</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt; 1 2019-12-25      Christmas</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt; 2 2019-12-26           &lt;NA&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt; 3 2010-12-31 New Year&#39;s Day</span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt; 4 2011-01-01           &lt;NA&gt;</span></span></code></pre></div>
<p>Note that because our calendar has observance rules baked in, it
shows <code>2010-12-31</code> (a Friday) as New Year’s Day rather than
the 1st of the year (a Saturday).</p>
</div>
<div id="us-federal-calendar" class="section level3">
<h3>US federal calendar</h3>
<p>almanac comes with one pre-built calendar,
<code>cal_us_federal()</code>, which contains the federally recognized
holidays in the United States. It is meant to serve as an example of
what you can build with almanac, but it is also pretty useful on its
own:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">cal_us_federal</span>()</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; &lt;rcalendar[11]&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; • New Year&#39;s Day</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; • US Martin Luther King Jr. Day</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; • US Presidents&#39; Day</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; • US Memorial Day</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; • US Juneteenth</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; • US Independence Day</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; • US Labor Day</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; • US Indigenous Peoples&#39; Day</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; • US Veterans Day</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt; • US Thanksgiving</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt; • Christmas</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">cal_events</span>(<span class="fu">cal_us_federal</span>(), <span class="at">year =</span> <span class="dv">2023</span>)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt;                             name       date</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt; 1                 New Year&#39;s Day 2023-01-02</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt; 2  US Martin Luther King Jr. Day 2023-01-16</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; 3             US Presidents&#39; Day 2023-02-20</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; 4                US Memorial Day 2023-05-29</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt; 5                  US Juneteenth 2023-06-19</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt; 6            US Independence Day 2023-07-04</span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; 7                   US Labor Day 2023-09-04</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt; 8     US Indigenous Peoples&#39; Day 2023-10-09</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt; 9                US Veterans Day 2023-11-10</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt; 10               US Thanksgiving 2023-11-23</span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt; 11                     Christmas 2023-12-25</span></span></code></pre></div>
<p>Note that this calendar doesn’t claim to be historically accurate, it
is only intended to be a representation of the current federally
recognized holidays. You <em>can</em> build historically accurate
calendars (i.e. you can represent that Juneteenth wasn’t celebrated
before 2021) it just takes a bit more effort.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
